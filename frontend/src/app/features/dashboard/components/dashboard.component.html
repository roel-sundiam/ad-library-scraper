<div class="dashboard-container">
  <div class="dashboard-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">Welcome to ScrapeIQ</h1>
        <p class="page-subtitle">Your intelligent competitor analysis platform</p>
      </div>
      <div class="header-icon">
        <div class="animated-icon">
          <mat-icon>analytics</mat-icon>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Connecting to API...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-container">
    <mat-card class="error-card">
      <mat-card-content>
        <div class="error-content">
          <mat-icon class="error-icon">error</mat-icon>
          <div>
            <h3>Connection Error</h3>
            <p>{{ error }}</p>
            <p class="error-help">Make sure your Node.js backend server is running on port 3000.</p>
            <button mat-raised-button color="primary" (click)="checkApiHealth()">
              Retry Connection
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Success State -->
  <div *ngIf="apiHealth && !isLoading" class="dashboard-content">
    <!-- Competitor Analysis Hub - Primary Feature -->
    <mat-card class="competitor-analysis-hub">
      <div class="hub-header">
        <div class="hub-background">
          <div class="hub-gradient-overlay"></div>
        </div>
        <div class="hub-content">
          <div class="hub-icon-badge">
            <mat-icon>insights</mat-icon>
          </div>
          <div class="hub-text">
            <h2>Competitor Intelligence</h2>
            <p>Unlock strategic insights from your competitor's Facebook advertising campaigns with AI-powered analysis</p>
          </div>
          <div class="hub-stats">
            <div class="stat-item">
              <span class="stat-number">4-Tier</span>
              <span class="stat-label">Fallback System</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">AI-Powered</span>
              <span class="stat-label">Video Analysis</span>
            </div>
          </div>
        </div>
      </div>
      
      <mat-card-content class="hub-actions">
        <div class="primary-action">
          <button 
            mat-raised-button 
            class="start-analysis-btn"
            routerLink="/competitor-analysis"
            color="primary">
            <div class="btn-content">
              <mat-icon>rocket_launch</mat-icon>
              <span>Start Competitor Analysis</span>
            </div>
          </button>
          
          <p class="action-description">
            <mat-icon>info</mat-icon>
            Analyze Facebook ads from any competitor page URL
          </p>
        </div>
        
        <div class="secondary-actions">
          <button 
            mat-stroked-button 
            class="view-results-btn"
            routerLink="/competitor-analysis/facebook-dashboard"
            *ngIf="hasExistingAnalysis">
            <mat-icon>visibility</mat-icon>
            <span>View Results</span>
          </button>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- API Status Card - Super Admin Only -->
    <mat-card class="status-card" *ngIf="isSuperAdmin">
      <mat-card-header>
        <mat-card-title>API Status</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="status-grid">
          <div class="status-item">
            <span class="status-label">Status</span>
            <span class="status-value success">{{ apiHealth.data?.status || 'Unknown' }}</span>
          </div>
          <div class="status-item">
            <span class="status-label">Version</span>
            <span class="status-value">{{ apiHealth.data?.version || 'N/A' }}</span>
          </div>
          <div class="status-item">
            <span class="status-label">Database</span>
            <span class="status-value success">{{ apiHealth.data?.database || 'Unknown' }}</span>
          </div>
          <div class="status-item">
            <span class="status-label">Uptime</span>
            <span class="status-value">{{ apiHealth.data?.uptime || 0 }}s</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Facebook Token Configuration - Super Admin Only -->
    <mat-card class="token-config-card" *ngIf="isSuperAdmin">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>vpn_key</mat-icon>
          Facebook API Configuration
        </mat-card-title>
        <mat-card-subtitle>Configure your Facebook access token for real ads data</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="token-status" *ngIf="tokenStatus">
          <div class="status-indicator" [class]="tokenStatus.hasToken ? 'status-active' : 'status-missing'">
            <mat-icon>{{ tokenStatus.hasToken ? 'check_circle' : 'error' }}</mat-icon>
            <span>{{ tokenStatus.hasToken ? 'Token Active' : 'Token Missing' }}</span>
          </div>
          <div *ngIf="tokenStatus.hasToken" class="token-info">
            <small>{{ tokenStatus.tokenPreview }} ({{ tokenStatus.tokenLength }} chars)</small>
          </div>
        </div>

        <div class="token-actions">
          <button mat-raised-button 
                  color="primary" 
                  (click)="showTokenForm = !showTokenForm"
                  [disabled]="isUpdatingToken">
            <mat-icon>{{ showTokenForm ? 'close' : 'edit' }}</mat-icon>
            {{ showTokenForm ? 'Cancel' : 'Update Token' }}
          </button>
          
          <button mat-stroked-button 
                  (click)="openFacebookConsole()"
                  title="Get a new Facebook access token">
            <mat-icon>open_in_new</mat-icon>
            Get Token
          </button>
        </div>

        <!-- Token Update Form -->
        <div *ngIf="showTokenForm" class="token-form">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Facebook Access Token</mat-label>
            <textarea matInput 
                      [(ngModel)]="newToken"
                      placeholder="EAA..."
                      rows="3"
                      (keyup.enter)="updateFacebookToken()"></textarea>
            <mat-hint>Paste your Facebook access token here</mat-hint>
          </mat-form-field>
          
          <div class="form-actions">
            <button mat-raised-button 
                    color="primary" 
                    (click)="updateFacebookToken()"
                    [disabled]="!newToken || isUpdatingToken">
              <mat-spinner *ngIf="isUpdatingToken" diameter="20"></mat-spinner>
              <mat-icon *ngIf="!isUpdatingToken">save</mat-icon>
              {{ isUpdatingToken ? 'Updating...' : 'Save Token' }}
            </button>
          </div>
        </div>

        <!-- Messages -->
        <div *ngIf="tokenMessage" class="token-message" [class]="tokenMessage.type">
          <mat-icon>{{ 
            tokenMessage.type === 'success' ? 'check_circle' : 
            tokenMessage.type === 'warning' ? 'warning' : 'error' 
          }}</mat-icon>
          <span>{{ tokenMessage.text }}</span>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>